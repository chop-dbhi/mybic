define(["jquery","underscore"],function(e,t){var n;return n={deferred:{},initialize:function(){var e,t,n,r,i=this;this.pending(),r=this.deferred,n=function(e,t){var n;return n=i[e],i[e]=function(){return i.defer(e,n,t,arguments)}};for(e in r)t=r[e],n(e,t)},pending:function(){return(this._deferred=e.Deferred()).once={},this},defer:function(e,n,r,i){r==null&&(r=!1),this._deferred==null&&this.pending();if(t.isString(e)){t.isBoolean(n)&&(r=n,n=this[e]);if(r){if(this._deferred[e])return this;this._deferred.once[e]=!0}}else n=e;return this._deferred.done(function(){return n.apply(null,i)}),this},resolve:function(e){return e==null&&(e=this),this._deferred&&this._deferred.resolveWith(e),this},reject:function(e){return e==null&&(e=this),this._deferred&&this._deferred.rejectWith(e),this},promise:function(){var e;return this._deferred==null&&this.pending(),(e=this._deferred).promise.apply(e,arguments)},when:function(t){return e.when(this).done(t)},state:function(){var e;return(e=this._deferred)!=null?e.state():void 0}},n.resolveWith=n.resolve,n.rejectWith=n.reject,{Deferrable:n}});